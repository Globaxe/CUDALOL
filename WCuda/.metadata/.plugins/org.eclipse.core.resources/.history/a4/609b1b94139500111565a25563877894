#include <iostream>
#include "Indice2D.h"
#include "cudaTools.h"
#include "Device.h"

using std::cerr;
using std::cout;
using std::endl;

/*----------------------------------------------------------------------*\
 |*			Declaration 					*|
 \*---------------------------------------------------------------------*/

/*--------------------------------------*\
 |*		Imported	 	*|
 \*-------------------------------------*/

extern __global__ void toGray(uchar4* ptrDev_image, int w, int h);
extern __global__ void toFlou(uchar4* ptrDev_image, int w, int h);

/*--------------------------------------*\
 |*		Public			*|
 \*-------------------------------------*/

void modifyImage(uchar4* ptrDev_Image, int w, int h,cudaStream_t stream=0);// 0 stream par default

/*--------------------------------------*\
 |*		Private			*|
 \*-------------------------------------*/

/*----------------------------------------------------------------------*\
 |*			Implementation 					*|
 \*---------------------------------------------------------------------*/

/*--------------------------------------*\
 |*		Public			*|
 \*-------------------------------------*/


void modifyImage(uchar4* ptrDev_Image, int w, int h,cudaStream_t stream)
    {
    //cout<<"modifyImage"<<stream<<endl;

    dim3 blockPerGrid = dim3(8, 8, 1);
    dim3 threadPerBlock = dim3(16, 16, 1);

   // print(blockPerGrid, threadPerBlock);
   // Device::assertDim(blockPerGrid,threadPerBlock);

    toGray<<<blockPerGrid,threadPerBlock,0,stream>>>(ptrDev_Image, w, h);
    //qtoFlou<<<blockPerGrid,threadPerBlock,0,stream>>>(ptrDev_Image, w, h);

    check_CUDA_Error(); // TODO mettre dans cudatuto


    // paramètre 3 de <<<blockPerGrid,threadPerBlock,0,stream>>> :
    // Goal : spécifier le nombre d'octets en mémoire partagée alloués dynamiquement par bloc en plus de la mémoire allouée statiquement; 0 valeur par defaut
    }

/*--------------------------------------*\
 |*		Private			*|
 \*-------------------------------------*/



/*----------------------------------------------------------------------*\
 |*			End	 					*|
 \*---------------------------------------------------------------------*/

